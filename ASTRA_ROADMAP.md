# ASTRA: статус, путь к релизу и объяснение простыми словами

## 1) Что уже сделано
### Ядро протокола
- Собственный handshake (подпись, токен, профиль, transport, obfs, network_id)
- Проверка подписи, anti-replay, токены/trial/revoke
- Rate-limit и блокировка по ошибкам (anti-abuse)

### Транспорт и маскировка
- TCP, UDP, TLS (uTLS с JA3/ALPN), RUDP (retransmit/ACK)
- Фрейминг + padding всего потока
- TLS-обфускация: preface + HTTP/2 frames, фрагментация handshake

### Адаптивность
- Профили SNI + локальное обучение (score/RTT)
- Переключение по профилям/транспортам
- NetworkID учитывается (wifi/cell/eth)

### Сеть и узлы
- Entry → Relay → Exit цепочка
- Health-checks и fallback по узлам
- Egress-политики на Exit (DNS-only, deny/allow по host/port/CIDR)

### Инструменты
- DPI lab (proxy + load test)
- Базовые тесты (handshake, framing, mux)
- Метрики auth_ok/auth_deny

---

## 2) Что ещё нужно сделать (до production)
### Безопасность и аудит
- Внешний аудит протокола
- Устранение атак (replay/DoS/токены)

### Реальные полевые тесты
- Долгие сессии (часы/дни)
- Разные ISP/страны/мобильные сети

### Стабильность и качество
- Нагрузочные тесты в CI
- Мониторинг, алерты, аварийные режимы

### Клиентская часть
- Обновления клиента
- Управление конфигом
- Сбор телеметрии отказов (без утечек)
- **Windows полный туннель:** WinDivert не умеет инжект входящих (код 87) → вариант через **WFP** (драйвер + агент), см. `docs/WINDOWS_WFP_PLAN.md`

---

## 2.1) Что дальше по роудмапу (после поднятия TUN)

Туннель поднят (Client ↔ Entry [↔ Relay] ↔ Exit, TUN на Windows работает). Ниже — приоритеты без GUI.

### Ближайшие шаги (стабильность и поле)
1. **Долгие сессии** — гонять 24–72 ч, смотреть обрывы, память, переподключения.
2. **DPI lab** — прогон по разным профилям/транспортам, фиксация, что режет ISP.
3. **Метрики и логи** — auth_ok/auth_deny, ошибки handshake, разрывы; без PII.
4. **CI** — автоматические тесты (handshake, framing, mux, один E2E сценарий).

### Средний срок (платформа)
5. **Обновления клиента** — механизм проверки версии и безопасного апдейта.
6. **Конфиг/профили** — управление с сервера или через GUI позже.
7. **WFP (Windows)** — полный туннель без ограничений WinDivert, по `docs/WINDOWS_WFP_PLAN.md`.

### Следующая ступень (усиление протокола)
8. **Динамический транспорт** — смена TLS/RUDP/TCP по ходу сессии без разрыва.
9. **Traffic morphing** — укладка трафика в заданный шаблон (например, под определённый JA3/фреймы).
10. **E2E шифрование Client ↔ Exit** (опционально) — Entry/Relay видят только шифрованный поток; нужен общий секрет или ключ на Exit.
11. **PFS (ECDH в handshake)** — одноразовые ключи сессии, чтобы компромисс долгоживущего ключа не вскрывал прошлые сессии.

**Приоритет по смыслу ASTRA:** сначала стабильность и поле (1–4), потом клиент и WFP (5–7). Пункты 8–9 (динамический транспорт, morphing) сильнее всего бьют в цель «обход DPI». E2E (10) и PFS (11) — если нужна модель «Entry/Relay не видят содержимое» и защита от компромисса ключа; для многих сценариев текущая модель (шифрование до Entry, дальше по доверенной цепочке) достаточна.

---

## 3) Чёткий путь к релизу
### Alpha (техдемо)
1. Прогон DPI lab на разных режимах
2. Длинные сессии (24–72 часа)
3. Стабильность RUDP/TLS/MUX

### Beta (пилот)
1. Тест с реальными пользователями
2. Мониторинг отказов/метрик
3. Оптимизация поведения под ISP

### Release (production)
1. Безопасностный аудит
2. Документация и SLA
3. CI/CD + регрессия по тестам

---

## 4) Простыми словами: как работает ASTRA
**Идея:** это не просто VPN-туннель, а “умная система”, которая маскируется под обычный веб-трафик и постоянно адаптируется.

**Шаги:**
1. **Клиент** создает крипто-идентичность (ключи + ClientID).
2. Клиент **подписывает handshake**, добавляет токен/профиль/SNI/transport.
3. **Entry** проверяет подпись и токен, отсекает злоупотребления.
4. Трафик идет через **Entry → Relay → Exit**, при этом:
   - данные упакованы в “обычный” формат
   - могут идти поверх TLS с реальным JA3
   - фрейминг и padding скрывают паттерны
5. Клиент учится: **что лучше работает в этой сети**, и сам выбирает профиль.

---

## 5) Чем ASTRA отличается от VLESS и Hysteria
### VLESS
- Это **простой прокси-протокол** без адаптивности.
- SNI = просто строка в конфиге, нет динамики.
- В ASTRA SNI — **пул профилей + авто-выбор**.

### Hysteria
- Делает упор на **скорость и UDP-ускорение**.
- Не фокусируется на anti-DPI уровне TLS/JA3.
- ASTRA строится как **anti-DPI-first**, с адаптивной мимикрией.

**Итог:**  
ASTRA — не «ещё один VLESS» и не «ещё одна Hysteria».  
Это адаптивная система, которая сама выбирает лучший способ прохода DPI и умеет быстро менять тактику.

---

## 6) Где это реализовано (основные файлы)
- Handshake/протокол: `internal/protocol/handshake.go`
- Token/revoke: `internal/auth/*`
- Transports (TCP/UDP/TLS/RUDP): `internal/transport/*`
- MUX: `internal/transport/mux.go`
- Learning/SNI: `internal/learning/*`, `internal/sni/*`
- Entry: `cmd/astra-entry/main.go`
- Relay: `cmd/astra-relay/main.go`
- Exit: `cmd/astra-exit/main.go`
- DPI Lab: `cmd/astra-lab/main.go`
